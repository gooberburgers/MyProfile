<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GROUNDBREAKING!</title>

  <!-- Site Icon (Favicon) -->
  <link rel="icon" type="image/png" href="assets/roblox.png">

  <link rel="stylesheet" href="7.css">
  <style>
/* Gerald Section Styles */
.gerald-section {
  position: fixed;
  right: 30px;
  top: 30px;
  width: 500px;
  z-index: 100;
}

.gerald-window {
  background: rgba(255, 255, 255, 0.9);
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  overflow: hidden;
  backdrop-filter: blur(10px);
}

.gerald-window .title-bar {
  background: linear-gradient(180deg, #0066cc, #0052a3);
  color: white;
  padding: 8px 12px;
  font-weight: 600;
  font-size: 0.9em;
}

.gerald-window .window-body {
  padding: 15px;
}

.gerald-window img {
  width: 100%;
  height: auto;
  border-radius: 8px;
  margin-bottom: 15px;
  cursor: pointer;
  transition: transform 0.3s ease;
}

.gerald-window img:hover {
  transform: scale(1.02);
}

.gerald-window img.clicked {
  cursor: not-allowed;
  opacity: 0.7;
}

.gerald-window h3 {
  color: #0066cc;
  margin-bottom: 10px;
  font-size: 1em;
}

.gerald-window p {
  font-size: 0.85em;
  line-height: 1.5;
  color: #333;
  margin: 0;
}

/* Gerald Character Animation */
#geraldCharacter {
  position: fixed;
  bottom: -600px;
  right: 50px;
  width: 400px;
  height: 600px;
  z-index: 9999;
  pointer-events: none;
  transition: bottom 2s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

#geraldCharacter.active {
  bottom: -100px;
}

#geraldBase {
  position: relative;
  width: 100%;
  height: 100%;
}

#geraldHead {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  animation: geraldShake 0.1s infinite;
}

#geraldHead img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

@keyframes geraldShake {
  0% { transform: translate(0, 0) rotate(0deg); }
  25% { transform: translate(1px, -1px) rotate(0.5deg); }
  50% { transform: translate(-1px, 1px) rotate(-0.5deg); }
  75% { transform: translate(1px, 1px) rotate(0.3deg); }
  100% { transform: translate(0, 0) rotate(0deg); }
}

/* Overlay to block interactions */
#geraldOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.3);
  z-index: 9998;
  display: none;
}

#geraldOverlay.active {
  display: block;
}

/* Responsive adjustments */
@media (max-width: 1000px) {
  .gerald-section {
    position: relative;
    right: auto;
    top: auto;
    margin: 20px auto;
  }
}

body {
  background: linear-gradient(#a0c4ff, #caffbf);
  padding: 30px;
  font-family: 'Segoe UI', sans-serif;
  margin: 0;
}

.window {
  width: 600px;
  margin: 0 auto;
  animation: fadeIn 1.5s ease-in-out;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.group-box {
  margin-bottom: 20px;
}

h2 {
  margin-bottom: 8px;
}

ul {
  margin: 0;
  padding-left: 20px;
}

.roblox-links a {
  display: inline-block;
  margin-right: 10px;
}

.profile-header {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 15px;
}

.profile-header img {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  border: 3px solid #0066cc;
}

.profile-info h1 {
  font-size: 1.8em;
  margin: 0;
  color: #0066cc;
}

.socials {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.socials a {
  display: flex;
  align-items: center;
  gap: 8px;
  text-decoration: none;
  color: #0066cc;
  transition: transform 0.3s ease;
  font-size: 0.9em;
}

.socials a:hover {
  transform: scale(1.05);
}

.socials img {
  width: 20px;
  height: 20px;
}

#bg {
  position: fixed;
  top: 0;
  left: 0;
  z-index: -1;
  opacity: 0.3;
}

/* Art Section Styles */
.art-section {
  margin-top: 30px;
  padding: 20px;
  background: rgba(255, 255, 255, 0.3);
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  backdrop-filter: blur(10px);
}

.art-section h2 {
  color: #0066cc;
  margin-bottom: 15px;
  text-align: center;
}

.canvas-container {
  position: relative;
  display: flex;
  justify-content: center;
  margin-bottom: 15px;
}

#drawingCanvas {
  border: 2px solid #0066cc;
  border-radius: 8px;
  cursor: crosshair;
  background: white;
  position: relative;
  z-index: 1;
  touch-action: none;
}

.art-controls {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  align-items: center;
  justify-content: center;
  margin-bottom: 15px;
  padding: 10px;
  background: rgba(255, 255, 255, 0.4);
  border-radius: 8px;
  backdrop-filter: blur(5px);
}

.control-group {
  display: flex;
  align-items: center;
  gap: 5px;
}

.control-group label {
  font-size: 0.9em;
  color: #333;
  font-weight: 500;
}

input[type="color"] {
  width: 40px;
  height: 30px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

input[type="range"] {
  width: 80px;
}

/* Enhanced Aero-style buttons */
.tool-btn, 
button:not(.socials button),
.submit-art-btn,
.submit-message-btn,
#pronounceBtn {
  background: linear-gradient(to bottom, #f2f2f2 45%, #ebebeb 45%, #cfcfcf);
  border: 1px solid #8e8f8f;
  border-radius: 3px;
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.8);
  color: #222;
  font-family: 'Segoe UI', sans-serif;
  font-size: 9pt;
  min-height: 23px;
  padding: 0 12px;
  position: relative;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
}

.tool-btn:before,
button:not(.socials button):before,
.submit-art-btn:before,
.submit-message-btn:before,
#pronounceBtn:before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(to bottom, #eaf6fd 45%, #bee6fd 45%, #a7d9f5);
  border-radius: 3px;
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.8);
  opacity: 0;
  transition: opacity 0.3s;
  z-index: -1;
}

.tool-btn:hover:before,
button:not(.socials button):hover:before,
.submit-art-btn:hover:not(:disabled):before,
.submit-message-btn:hover:not(:disabled):before,
#pronounceBtn:hover:before {
  opacity: 1;
}

.tool-btn:hover,
button:not(.socials button):hover,
.submit-art-btn:hover:not(:disabled),
.submit-message-btn:hover:not(:disabled),
#pronounceBtn:hover {
  border-color: #3c7fb1;
}

.tool-btn:active,
button:not(.socials button):active,
.submit-art-btn:active:not(:disabled),
.submit-message-btn:active:not(:disabled),
#pronounceBtn:active {
  background: linear-gradient(to bottom, #e5f4fc, #c4e5f6 30% 50%, #98d1ef 50%, #68b3db);
  box-shadow: inset 1px 1px 0 rgba(0, 0, 0, 0.2), inset -1px 1px 0 rgba(0, 0, 0, 0.1);
  border-color: #6d91ab;
}

.tool-btn.active {
  background: linear-gradient(to bottom, #e5f4fc, #c4e5f6 30% 50%, #98d1ef 50%, #68b3db);
  box-shadow: inset 1px 1px 0 rgba(0, 0, 0, 0.2), inset -1px 1px 0 rgba(0, 0, 0, 0.1);
  border-color: #6d91ab;
}

.submit-art-btn,
.submit-message-btn {
  width: 100%;
  padding: 12px;
  font-size: 1em;
}

.submit-art-btn {
  background: linear-gradient(to bottom, #d4f5d4 45%, #b8e6b8 45%, #9dd09d);
  border-color: #5a9a5a;
}

.submit-art-btn:before {
  background: linear-gradient(to bottom, #e0f7e0 45%, #c8edc8 45%, #a8d5a8);
}

.submit-art-btn:hover:not(:disabled) {
  border-color: #4a8a4a;
}

.submit-art-btn:active:not(:disabled) {
  background: linear-gradient(to bottom, #b8e6b8, #9dd09d 30% 50%, #82bd82 50%, #67a767);
}

.submit-message-btn {
  background: linear-gradient(to bottom, #d4e8f5 45%, #b8d9eb 45%, #9dcce0);
  border-color: #5a8fa0;
}

.submit-message-btn:before {
  background: linear-gradient(to bottom, #e0f0f7 45%, #c8e3f0 45%, #a8d3e6);
}

.submit-message-btn:hover:not(:disabled) {
  border-color: #4a7f90;
}

.submit-message-btn:active:not(:disabled) {
  background: linear-gradient(to bottom, #b8d9eb, #9dcce0 30% 50%, #82bad4 50%, #67a8c8);
}

button:disabled,
.submit-art-btn:disabled,
.submit-message-btn:disabled {
  background: #f4f4f4;
  border-color: #aeb2b5;
  color: #838383;
  cursor: not-allowed;
  opacity: 0.6;
}

button:disabled:before,
.submit-art-btn:disabled:before,
.submit-message-btn:disabled:before {
  display: none;
}

#pronounceBtn {
  margin-top: 5px;
  padding: 6px 12px;
  font-size: 0.9em;
}

/* Message Section Styles */
.message-section {
  margin-top: 20px;
  padding: 20px;
  background: rgba(255, 255, 255, 0.3);
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  backdrop-filter: blur(10px);
}

.message-section h2 {
  color: #0066cc;
  margin-bottom: 15px;
  text-align: center;
}

#messageText {
  width: 100%;
  height: 100px;
  padding: 10px;
  border: 2px solid #0066cc;
  border-radius: 8px;
  font-family: inherit;
  font-size: 0.9em;
  resize: vertical;
  margin-bottom: 15px;
  box-sizing: border-box;
}

.status-message {
  padding: 10px;
  margin-top: 10px;
  border-radius: 6px;
  text-align: center;
  font-weight: 500;
}

.status-success {
  background: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}

.status-error {
  background: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}

.status-warning {
  background: #fff3cd;
  color: #856404;
  border: 1px solid #ffeaa7;
}

/* Loading spinner */
.loading-spinner {
  display: inline-block;
  width: 16px;
  height: 16px;
  border: 2px solid #ffffff;
  border-radius: 50%;
  border-top-color: transparent;
  animation: spin 1s ease-in-out infinite;
  margin-right: 8px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}
  </style>
</head>

<!-- Gerald Overlay -->
<div id="geraldOverlay"></div>

<!-- Gerald Character -->
<div id="geraldCharacter">
  <div id="geraldBase">
    <div id="geraldHead">
      <img src="assets/geraldHimself.png" alt="Gerald">
    </div>
  </div>
</div>

<body>
  <canvas id="bg"></canvas>
  
  <div class="window active">
    <div class="title-bar">
      <div class="title-bar-text">introduction.txt</div>
    </div>
    <div class="window-body">
      <div class="group-box">
        <div class="profile-header">
          <img src="assets/groovygiggler2.png" alt="profile image">
          <div class="profile-info">
            <h1>omegadogey (dogey)</h1>
            <button id="pronounceBtn">pronounce</button>
            <audio id="nameAudio" src="assets/myname.wav"></audio>
          </div>
        </div>
        <p>[Texas > USA]</p>
		<p>[Age: 14] 5/23/2011 ðŸŽ‚</p>
      </div>

      <div class="group-box">
        <h2>[Before you Interact...]</h2>
        <ul>
          <li>Being here to attempt to troll/ragebait/creep me up you'll be getting a plate of nothingness in return :0)</li>
		  <li>I don't have any serious big fat stupid mental issues so don't heavily worry about me, I'm fine!</li>
		  <li>I freak out and get angry rarely but even if I am at a low point or mood in my life, I'll still talk, I'm resilient!</li>
        </ul>
      </div>

      <div class="group-box">
        <h2>[I like...]</h2>
        <ul>
          <li>Welcoming/neutral Spaces.</li>
          <li>Games: ROBLOX, Pressure, Super Check Point, Regretevator</li>
          <li>Aesthetics: old imagery/media, 90's aesthetics, win vista/frutiger aero, 2016-2019 ROBLOX</li>
		  <li>Heavily Interested: Rabbits or Bunnys hehehe send me images of them hehehoohohoo..f</li>
		  <li>Artists: ðŸŒŸ STOMACH BOOK, Femtanyl, Tyler The Creator</li>
		  <img src="https://github.com/gooberburgers/MyProfile/blob/main/assets/EvilAssMango.png?raw=true" alt="Evil Ass Mango" width="400">
        </ul>
      </div>

      <div class="group-box">
        <h2>[Hobbies & Talent...]</h2>
        <ul>
          <li>Music Composing, Animation, Modelling/Blender, Scripting, VFX, Sound Design, Storywriting, Advice, Graphic Design, Art, HTML. :0)</li>
        </ul>
      </div>

	  <div class="group-box">
        <h2>[Mental Issues...]</h2>
        <ul>
          <li>Autism [Diagnosed], ADHD.</li>
		  <li>Despite the above conditions, I don't let them take over me and I've bent them in ways to be managed!</li>
        </ul>
      </div>

      <div class="group-box">
        <h2>[media/socials]</h2>
        <div class="socials">

          <a href="https://www.roblox.com/users/2938203100/profile" target="_blank" class="button">
            <img src="https://frutigeraeroarchive.org/images/icons/aero_artists/daniele63/roblox.ico" alt="roblox"> Alt Account 1/4 [PRIMARY!]
          </a>

		  <a href="https://www.youtube.com/@omegadogey/videos" target="_blank" class="button">
            <img src="https://frutigeraeroarchive.org/images/icons/mobile/ios/youtube.png" alt="youtube"> YouTube
          </a>

          <a href="https://www.roblox.com/users/1269656918/profile" target="_blank" class="button">
            <img src="https://frutigeraeroarchive.org/images/icons/aero_artists/daniele63/roblox.ico" alt="roblox"> Alt Account 2/4 [Very VERY inactive]
          </a>

          <a href="https://www.roblox.com/users/3613822810/profile" target="_blank" class="button">
            <img src="https://frutigeraeroarchive.org/images/icons/aero_artists/daniele63/roblox.ico" alt="roblox"> Alt Account 3/4 [Very VERY inactive]
          </a>

          <a href="https://www.roblox.com/users/3010382631/profile" target="_blank" class="button">
            <img src="https://frutigeraeroarchive.org/images/icons/aero_artists/daniele63/roblox.ico" alt="roblox"> Alt Account 4/4 [Very VERY inactive]
          </a>

          <a href="https://www.roblox.com/games/125432105048317/Bone-Calcium-MANIA" target="_blank" class="button">
            <img src="https://frutigeraeroarchive.org/images/icons/aero_artists/daniele63/roblox.ico" alt="roblox"> Game [BONE CALCIUM MANIA!]
          </a>

		  <a href="https://discord.gg/dn7j7wmPyf" target="_blank" class="button">
            <img src="https://frutigeraeroarchive.org/images/icons/communication/discord1.ico" alt="discord"> Discord Server [BONE CALCIUM MANIA!]
          </a>
          
        </div>
      </div>
      
      <div class="group-box">
        <p><em>absolutely GREAT-TASTIC! you've explored into me, hmm..!</em></p>
        <p><em>why not get a taste of sending me some art mail or message?! go for it! you're FULLY welcome!</em></p>
		<p><em>or if you could just so pretty please like an angel in the sky support my work! i love attention! that's up to YOU to decide!</em></p>
      </div>

      <!-- Art Section -->
      <div class="art-section">
        <h2>[send a doodle of you MURDERING me /joke]</h2>
        
        <div class="canvas-container">
          <canvas id="drawingCanvas" width="500" height="400"></canvas>
        </div>
        
        <div class="art-controls">
          <div class="control-group">
            <label for="brushColor">Color:</label>
            <input type="color" id="brushColor" value="#000000">
          </div>
          
          <div class="control-group">
            <label for="brushSize">Size:</label>
            <input type="range" id="brushSize" min="1" max="50" value="5">
            <span id="brushSizeDisplay">5</span>
          </div>
          
          <div class="control-group">
            <label for="brushOpacity">Opacity:</label>
            <input type="range" id="brushOpacity" min="0" max="100" value="100">
            <span id="brushOpacityDisplay">100%</span>
          </div>
          
          <button class="tool-btn active" id="penTool">Pen</button>
          <button class="tool-btn" id="eraserTool">Eraser</button>
          <button class="tool-btn" id="fillTool">Fill</button>
          <button class="tool-btn" id="undoBtn">Undo</button>
          <button class="tool-btn" id="redoBtn">Redo</button>
          <button class="tool-btn" id="clearCanvas">Clear</button>
        </div>
        
        <button class="submit-art-btn" id="submitArt">Send Doodle</button>
        <div id="artStatus"></div>
      </div>

      <!-- Message Section -->
      <div class="message-section">
        <h2>[send a THREAT... towards my family /joke]</h2>
        
        <textarea id="messageText" placeholder="Type your message here..."></textarea>
        
        <button class="submit-message-btn" id="submitMessage">Send Message</button>
        <div id="messageStatus"></div>
      </div>
    </div>
  </div>

<script src="canvas-encoder.js"></script>
<script>

// IP check script with continuous monitoring
(async function continuousBanCheck() {
  async function checkBan() {
    try {
      const response = await fetch('https://myprofilesenders.burgergwarf.workers.dev/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ banCheck: true })
      });

      if (response.status === 403) {
        window.location.href = 'https://myprofile-dkq.pages.dev/banned';
      }
    } catch (error) {
      console.log('Ban check failed:', error);
    }
  }

  await checkBan();
  setInterval(checkBan, 5000);
})();

// Background animation
const canvas = document.getElementById("bg");
const ctx = canvas.getContext("2d");
let dots = [];

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}

window.addEventListener("resize", resize);
resize();

for (let i = 0; i < 150; i++) {
  dots.push({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    r: Math.random() * 1.5 + 0.5,
    dx: Math.random() * 0.4 - 0.2,
    dy: Math.random() * 0.4 - 0.2
  });
}

function animate() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (let dot of dots) {
    ctx.beginPath();
    ctx.arc(dot.x, dot.y, dot.r, 0, Math.PI * 2);
    ctx.fillStyle = "rgba(255, 255, 255, 0.15)";
    ctx.fill();
    dot.x += dot.dx;
    dot.y += dot.dy;

    if (dot.x < 0 || dot.x > canvas.width) dot.dx *= -1;
    if (dot.y < 0 || dot.y > canvas.height) dot.dy *= -1;
  }
  requestAnimationFrame(animate);
}
animate();

// Pronounce button functionality
document.getElementById("pronounceBtn").addEventListener("click", function() {
  const audio = document.getElementById("nameAudio");
  audio.play();
});
	
// Enhanced Drawing canvas functionality
const drawingCanvas = document.getElementById('drawingCanvas');
const drawingCtx = drawingCanvas.getContext('2d');
let isDrawing = false;
let currentTool = 'pen';
let lastX = 0;
let lastY = 0;
let canvasHistory = [];
let historyIndex = -1;

// Initialize canvas with white background and save initial state
drawingCtx.fillStyle = 'white';
drawingCtx.fillRect(0, 0, drawingCanvas.width, drawingCanvas.height);
saveCanvasState();

// Tool selection
document.getElementById('penTool').addEventListener('click', function() {
  currentTool = 'pen';
  document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
  this.classList.add('active');
});

document.getElementById('eraserTool').addEventListener('click', function() {
  currentTool = 'eraser';
  document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
  this.classList.add('active');
});

document.getElementById('fillTool').addEventListener('click', function() {
  currentTool = 'fill';
  document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
  this.classList.add('active');
});

document.getElementById('clearCanvas').addEventListener('click', function() {
  drawingCtx.fillStyle = 'white';
  drawingCtx.fillRect(0, 0, drawingCanvas.width, drawingCanvas.height);
  saveCanvasState();
});

// Undo functionality
document.getElementById('undoBtn').addEventListener('click', function() {
  if (historyIndex > 0) {
    historyIndex--;
    restoreCanvasState();
  }
});

// Redo functionality
document.getElementById('redoBtn').addEventListener('click', function() {
  if (historyIndex < canvasHistory.length - 1) {
    historyIndex++;
    restoreCanvasState();
  }
});

// Save canvas state to history
function saveCanvasState() {
  historyIndex++;
  if (historyIndex < canvasHistory.length) {
    canvasHistory.length = historyIndex;
  }
  canvasHistory.push(drawingCanvas.toDataURL());
  
  // Limit history to 50 states to prevent memory issues
  if (canvasHistory.length > 50) {
    canvasHistory.shift();
    historyIndex--;
  }
}

// Restore canvas state from history
function restoreCanvasState() {
  const img = new Image();
  img.onload = function() {
    drawingCtx.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);
    drawingCtx.drawImage(img, 0, 0);
  };
  img.src = canvasHistory[historyIndex];
}

// Brush controls
document.getElementById('brushSize').addEventListener('input', function() {
  document.getElementById('brushSizeDisplay').textContent = this.value;
});

document.getElementById('brushOpacity').addEventListener('input', function() {
  document.getElementById('brushOpacityDisplay').textContent = this.value + '%';
});

// Get coordinates relative to canvas
function getCanvasCoordinates(e) {
  const rect = drawingCanvas.getBoundingClientRect();
  const scaleX = drawingCanvas.width / rect.width;
  const scaleY = drawingCanvas.height / rect.height;
  
  let clientX, clientY;
  
  if (e.touches && e.touches.length > 0) {
    clientX = e.touches[0].clientX;
    clientY = e.touches[0].clientY;
  } else {
    clientX = e.clientX;
    clientY = e.clientY;
  }
  
  return {
    x: (clientX - rect.left) * scaleX,
    y: (clientY - rect.top) * scaleY
  };
}

// Drawing functions
function startDrawing(e) {
  e.preventDefault();
  
  const coords = getCanvasCoordinates(e);
  
  if (currentTool === 'fill') {
    floodFill(Math.floor(coords.x), Math.floor(coords.y));
    return;
  }
  
  isDrawing = true;
  lastX = coords.x;
  lastY = coords.y;
}

function draw(e) {
  if (!isDrawing || (currentTool !== 'pen' && currentTool !== 'eraser')) return;
  
  e.preventDefault();
  
  const coords = getCanvasCoordinates(e);
  const brushSize = document.getElementById('brushSize').value;
  const brushColor = currentTool === 'eraser' ? '#ffffff' : document.getElementById('brushColor').value;
  const brushOpacity = document.getElementById('brushOpacity').value / 100;
  
  drawingCtx.globalCompositeOperation = 'source-over';
  drawingCtx.lineWidth = brushSize;
  drawingCtx.lineCap = 'round';
  drawingCtx.strokeStyle = brushColor;
  drawingCtx.globalAlpha = brushOpacity;
  
  drawingCtx.beginPath();
  drawingCtx.moveTo(lastX, lastY);
  drawingCtx.lineTo(coords.x, coords.y);
  drawingCtx.stroke();
  
  lastX = coords.x;
  lastY = coords.y;
}

function stopDrawing(e) {
  if (isDrawing) {
    e.preventDefault();
    isDrawing = false;
    saveCanvasState();
  }
}

// Flood fill algorithm
function floodFill(x, y) {
  const brushColor = document.getElementById('brushColor').value;
  const fillColor = hexToRgb(brushColor);
  
  const imageData = drawingCtx.getImageData(0, 0, drawingCanvas.width, drawingCanvas.height);
  const data = imageData.data;
  
  const targetColor = getPixelColor(data, x, y, drawingCanvas.width);
  
  if (colorsMatch(targetColor, fillColor)) return;
  
  const stack = [[x, y]];
  
  while (stack.length > 0) {
    const [currentX, currentY] = stack.pop();
    
    if (currentX < 0 || currentX >= drawingCanvas.width || 
        currentY < 0 || currentY >= drawingCanvas.height) continue;
    
    const currentColor = getPixelColor(data, currentX, currentY, drawingCanvas.width);
    
    if (!colorsMatch(currentColor, targetColor)) continue;
    
    setPixelColor(data, currentX, currentY, drawingCanvas.width, fillColor);
    
    stack.push([currentX + 1, currentY]);
    stack.push([currentX - 1, currentY]);
    stack.push([currentX, currentY + 1]);
    stack.push([currentX, currentY - 1]);
  }
  
  drawingCtx.putImageData(imageData, 0, 0);
  saveCanvasState();
}

function hexToRgb(hex) {
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result ? {
    r: parseInt(result[1], 16),
    g: parseInt(result[2], 16),
    b: parseInt(result[3], 16),
    a: 255
  } : null;
}

function getPixelColor(data, x, y, width) {
  const index = (y * width + x) * 4;
  return {
    r: data[index],
    g: data[index + 1],
    b: data[index + 2],
    a: data[index + 3]
  };
}

function setPixelColor(data, x, y, width, color) {
  const index = (y * width + x) * 4;
  data[index] = color.r;
  data[index + 1] = color.g;
  data[index + 2] = color.b;
  data[index + 3] = color.a;
}

function colorsMatch(color1, color2) {
  return color1.r === color2.r && color1.g === color2.g && 
         color1.b === color2.b && color1.a === color2.a;
}

// Mouse event listeners for drawing
drawingCanvas.addEventListener('mousedown', startDrawing);
drawingCanvas.addEventListener('mousemove', draw);
drawingCanvas.addEventListener('mouseup', stopDrawing);
drawingCanvas.addEventListener('mouseleave', stopDrawing);

// Touch events for mobile
drawingCanvas.addEventListener('touchstart', startDrawing, { passive: false });
drawingCanvas.addEventListener('touchmove', draw, { passive: false });
drawingCanvas.addEventListener('touchend', stopDrawing, { passive: false });
drawingCanvas.addEventListener('touchcancel', stopDrawing, { passive: false });

// Submit art functionality
document.getElementById('submitArt').addEventListener('click', function () {
  const artStatus = document.getElementById('artStatus');
  const submitBtn = document.getElementById('submitArt');
  const imageData = drawingCtx.getImageData(0, 0, drawingCanvas.width, drawingCanvas.height);
  const data = imageData.data;
  let hasDrawing = false;
  for (let i = 0; i < data.length; i += 4) {
    if (data[i] !== 255 || data[i + 1] !== 255 || data[i + 2] !== 255) {
      hasDrawing = true;
      break;
    }
  }
  if (!hasDrawing) {
    artStatus.innerHTML = '<div class="status-warning">Please draw something before submitting!</div>';
    return;
  }
  submitBtn.disabled = true;
  submitBtn.innerHTML = '<span class="loading-spinner"></span>Sending...';
  artStatus.innerHTML = '';
  const dataURL = drawingCanvas.toDataURL('image/png');
  fetch("https://myprofilesenders.burgergwarf.workers.dev/", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      image: dataURL
    })
  })
    .then(async response => {
      if (response.ok) {
        artStatus.innerHTML = '<div class="status-success">Your doodle has been sent to ME...!</div>';
        drawingCtx.fillStyle = 'white';
        drawingCtx.fillRect(0, 0, drawingCanvas.width, drawingCanvas.height);
        saveCanvasState();
      } else {
        const errorMessage = await response.text();
        throw new Error(errorMessage);
      }
    })
    .catch(error => {
      const errorText = error.message || 'Failed to send doodle. Please try again.';
      artStatus.innerHTML = `<div class="status-error">${errorText}</div>`;
      console.error('Error:', error);
    })
    .finally(() => {
      submitBtn.disabled = false;
      submitBtn.innerHTML = 'Send Doodle';
    });
});

// Submit message functionality
document.getElementById('submitMessage').addEventListener('click', function () {
  const messageText = document.getElementById('messageText').value.trim();
  const messageStatus = document.getElementById('messageStatus');
  const submitBtn = document.getElementById('submitMessage');
  if (messageText.length <= 1) {
    messageStatus.innerHTML = '<div class="status-error">Message must be longer than one character!</div>';
    return;
  }
  submitBtn.disabled = true;
  submitBtn.innerHTML = '<span class="loading-spinner"></span>Sending...';
  messageStatus.innerHTML = '';
  fetch("https://myprofilesenders.burgergwarf.workers.dev/", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      message: messageText
    })
  })
    .then(async response => {
      if (response.ok) {
        messageStatus.innerHTML = '<div class="status-success">Your message has been sent to ME...!</div>';
        document.getElementById('messageText').value = '';
      } else {
        const errorMessage = await response.text();
        throw new Error(errorMessage);
      }
    })
    .catch(error => {
      const errorText = error.message || 'Failed to send message. Please try again.';
      messageStatus.innerHTML = `<div class="status-error">${errorText}</div>`;
      console.error('Error:', error);
    })
    .finally(() => {
      submitBtn.disabled = false;
      submitBtn.innerHTML = 'Send Message';
    });
});

// Gerald functionality (if geraldTrigger element exists)
const geraldTrigger = document.getElementById('geraldTrigger');
if (geraldTrigger) {
  let geraldActivated = false;
  geraldTrigger.addEventListener('click', function() {
    if (geraldActivated) return;
    
    geraldActivated = true;
    this.classList.add('clicked');
    
    const geraldCharacter = document.getElementById('geraldCharacter');
    const geraldOverlay = document.getElementById('geraldOverlay');
    const geraldAudio = document.getElementById('geraldAudio');
    
    geraldOverlay.classList.add('active');
    geraldCharacter.classList.add('active');
    
    setTimeout(() => {
      if (geraldAudio) geraldAudio.play();
      
      setTimeout(() => {
        geraldCharacter.classList.remove('active');
        
        setTimeout(() => {
          geraldOverlay.classList.remove('active');
        }, 2000);
      }, 23500);
    }, 2000);
  });
}
</script>
</body>
</html>
